---
title: "Influence of climate indicators on tornado 'outbreak' environments"
author: "Zoe Schroder"
date: "5/1/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

**Make sure to answer these questions in the Introduction: **
Tornadoes will become more destructive in a warmer world. 
    1. How do you know this?
    2. Why is this important?
    3. How does this influence your research?
    
Environmental factors have been linked to individual climate change factors including....
    1. Cite the important literature
    2. How is what you are doing different?
    3. Why is this perspective so important? 

##Introduction: ##
    
Tornado outbreaks are becoming more extensive and destructive on average. Tornado days are declining annually; however, more tornadoes are occurring on these days \citep{ElsnerElsnerJagger2015, TippettEtAl2016, Moore2017, TippettCohen2016, Moore2018, MooreDeBoer2019}. \cite{SchroderElsner2019} use statistical models to quantify the role environmental conditions play in the variability of tornado outbreak characteristics, including accumulated tornado power (ATP), tornado counts, and casualties. Research suggests that ATP and tornado counts is increasing per annum \citep{SchroderElsner2019, ElsnerFrickerSchroder2018}. As a result, the risk for damage increases  \citep{ElsnerMurnaneJaggerWiden2013}. It is challenging to attribute shifts in tornado outbreak characteristics to climate change due to limited understanding between climate change and tornado outbreak environments \citep{ElsnerGuishard2014, ElsnerFrickerSchroder2018}

Researchers project severe convective weather to increase in the future due to more frequent environmental conditions \citep{DelGenioYaoJonas2007, TrappEtAl2007, HoogewindBaldwinTrapp2017, SeeleyRomps2015, DiffenbaughTrappBrooks2008, Brooks2013, SeeleyandRomps2015}. Environmental conditions include a combination of temperature and wind driven factors. CAPE and CIN are temperature-driven factors that are inversely related and represent the ability for air to rise in the atmosphere. CAPE and CIN are projected to increase due to rising surface temperatures \citep{ElsnerJaggerElsner2014, DelGenioYaoJonas2007, HoogewindBaldwinTrapp2017, Brooks2013, TrappEtAl2007, ElsnerFrickerSchroder2018}. BS and SRH are both wind-driven factors. BS represents the change in wind speed and direction over different depths of the atmosphere. BS is projected to decrease due to a limited temperature gradient between the equator and the poles \citep{Brooks2013, DiffenbaughTrappBrooks2008}. SRH represents the rotation within the storm and is projected to increase \citep{TippettEtAl2016}.  Research suggests that the decrease in bulk shear will be less than the projected increase in CAPE \citep{DelGenioYaoJonas2007, TrappEtAl2007, Brooks2013, HoogewindBaldwinTrapp2017}. As a result, favorable severe weather environments are expected to be more frequent \citep{DelGenioYaoJonas2007, TrappEtAl2007, Brooks2013, HoogewindBaldwinTrapp2017}. Researchers suggest shift in environmental factors as a result of climate change, but more work is needed to quantify and explain these potential changes. 

Limited research has been done to link climate change to tornado outbreak environments and associated characteristics. The studies that have been done do not match the scale of the outbreak. Researchers have analyzed climate change's role on severe convective weather at the storm level \citep{TrappandHoogewind2018, HoogewindBaldwinTrapp2017,DelGenioYaoJonas2007, DiffenbaughTrappBrooks2008}. Climate change is a larger scale phenomenon and should be considered with large scale physical processes such as tornado outbreaks. More work is needed to quantify how outbreak-level  environmental conditions are responding to climate change and influencing tornado outbreak characteristics (i.e., cluster severity, tornado counts, and casualty counts). 

The goal of this research is to quantify and explain the relationship between environmental conditions and climate change. We use the term cluster instead of outbreak because we do not associate the tornadoes with the synoptic setup. The objective is to understand the role of climate change on tornado cluster environments and how that change is affecting the climatology of tornado clusters. We will fit statistical models to predict tornado cluster environments using climate change factors, including sea ice extent, El Nino Southern Oscillation Index, global temperature anomalies, and western Caribbean sea surface temperatures. 

```{r}
load("BigDays.RData")
```

**Set the mercator projection for all figures**
```{r}
merc =  "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"
WGS84 <- 4326
```

```{r}
library(ggplot2)
library(dplyr)
library(ggpubr)
library(sf)
library(GGally)
library(USAboundaries)
library(tmap)
library(xtable)
```

```{r}
st_crs(BigDays.sfdfT) <- WGS84
```

Information on the data: 

Big Days: 

```{r}
mean(BigDays.sfdfT$nT)
max(BigDays.sfdfT$nT)

#What percentage of the clusters have less than the mean number of tornadoes. 
x <- BigDays.sfdfT %>%
  filter(nT <= 22)
dim(x)[1]/dim(BigDays.sfdfT)[1]
```


**Extract the geographic centroids of tornado genesis on big tornado days by creating an `sf` object using `st_centroid()` that reduces the MULTIPOINT geometry to a POINT geometry. Compute the area of the group and the number of tornadoes per area (density).**
```{r}
groupDayCentroids.sfdfT <- st_centroid(BigDays.sfdfT)
groupDayCentroids.sfdfT$groupArea <- st_area(st_convex_hull(BigDays.sfdfT))
groupDayCentroids.sfdfT$groupDensity <- groupDayCentroids.sfdfT$nT/groupDayCentroids.sfdfT$groupArea
```

```{r}
sts <- state.name[!state.name %in% c("Alaska", "Hawaii")]
stateBorders <- us_states(states = sts)
```


*Extract the Hull, centroids, and tornadoes for the May 30, 2004 big day. *

```{r}
May27 <- BigDays.sfdfT %>%
  filter(cDate == "1996-05-27")
May27 <- st_convex_hull(May27)

May27centroid <- groupDayCentroids.sfdfT %>%
  filter(cDate == "1996-05-27")

May27tornadoes <- BigDayTornadoes %>% 
  filter(groupNumber == May27centroid$groupNumber)

May27tornadoes <- May27tornadoes %>%
  mutate(Hour2 = ifelse(Hour <= 6, Hour + 24, Hour))
```

**Make a map of the May 30 tornado day. Obtain the state and county boundaries from the `USAboundaries` package. **
```{r}
May27tornadoes$Hour2 <- cut(as.numeric(May27tornadoes$Hour2), breaks=c(6,12,18,24,30))

May1996 <- (tm_shape(stateBorders) + 
  tm_borders(col = "gray70", alpha = 1) +
  tm_compass(size = 3, fontsize = 1, lwd = 2, color.dark = "gray70") + 
  tm_scale_bar(width = .3, size = 0.8, lwd = 1.75, color.dark = "gray70") +
  tm_layout(legend.bg.color = "white", 
            legend.text.size = .75, 
            attr.position = c("left", "bottom"), 
            inner.margins = c(.2, .2, .2, .2)) +
#tm_shape(counties.sf) +
#  tm_borders(col = "gray40", alpha = .3) +
#  tm_scale_bar(width = 8, size = 8, color.dark = "gray70") +
  #tm_format("World", legend.position = c("right", "top"),
#                   attr.position = c("right", "top"),
#                   legend.frame = FALSE,
                   #title = "May 30th Tornado Group",
                   #title.size = 1.3,
                   #title.position = c("left", "TOP"),
 #                  inner.margins = c(.2, .2, .2, .2)) +
tm_shape(May27, is.master = TRUE, projection = "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs") +
  tm_borders(col = "black", lwd = 3) +
tm_shape(May27tornadoes) +
  tm_symbols(size = 4, col = "Hour2", alpha = 0.8, palette = "BuPu", title.col = "Time [CST]", labels = c("6 to 12", "12 to 18", "18 to 24", "0 to 6"), border.alpha = 0) +
    tm_layout(legend.title.size = 1.1,
            legend.position = c("right", "bottom"), 
            legend.stack = "horizontal",
            legend.frame = FALSE, 
            legend.text.size = 1, legend.width = -0.2) +
tm_shape(May27centroid) +
  tm_symbols(size = 1.25, col = "black", shape = 24) +
  tm_layout(title = "May 27, 1996 \n 10 tornadoes", 
              title.position = c("center", "top"), 
              legend.title.size = 1.4,
              legend.position = c("right", "bottom"), 
              legend.stack = "horizontal",
              legend.frame = FALSE, 
              legend.text.size = 1.2, 
              legend.width = -0.2, 
              title.size = 1.5))
May1996
```

```{r}
May05 <- BigDays.sfdfT %>%
  filter(cDate == "2007-05-05")
May05 <- st_convex_hull(May05)

May05centroid <- groupDayCentroids.sfdfT %>%
  filter(cDate == "2007-05-05")

May05tornadoes <- BigDayTornadoes %>% 
  filter(groupNumber == May05centroid$groupNumber)

May05tornadoes <- May05tornadoes %>%
  mutate(Hour2 = ifelse(Hour <= 6, Hour + 24, Hour))
```

**Make a map of the May 30 tornado day. Obtain the state and county boundaries from the `USAboundaries` package. **
```{r}
May05tornadoes$Hour2 <- cut(May05tornadoes$Hour2, breaks=c(6,12,18,24,30))

May2007 <- (tm_shape(stateBorders) + 
  tm_borders(col = "gray70", alpha = 1) +
  tm_compass(size = 3, fontsize = 1, lwd = 2, color.dark = "gray70") +       
  tm_scale_bar(width = .3, size = 0.8, lwd = 1.75, color.dark = "gray70") +
  tm_layout(legend.bg.color = "white", 
            legend.text.size = .75, 
            attr.position = c("left", "bottom"), 
            inner.margins = c(.15, .15, .15, .15)) +
#tm_shape(counties.sf) +
#  tm_borders(col = "gray40", alpha = .3) +
#  tm_scale_bar(width = 8, size = 8, color.dark = "gray70") +
  #tm_format("World", legend.position = c("right", "top"),
#                   attr.position = c("right", "top"),
#                   legend.frame = FALSE,
                   #title = "May 30th Tornado Group",
                   #title.size = 1.3,
                   #title.position = c("left", "TOP"),
 #                  inner.margins = c(.2, .2, .2, .2)) +
tm_shape(May05, is.master = TRUE, projection = "+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs") +
  tm_borders(col = "black", lwd = 3) +
tm_shape(May05tornadoes) +
  tm_symbols(size = 4, col = "Hour2", alpha = 0.8, palette = "BuPu", title.col = "Time [CST]", labels = c("6 to 12", "12 to 18", "18 to 24", "0 to 6"), border.alpha = 0) +
    tm_layout(legend.title.size = 1.1,
            legend.position = c("right", "bottom"), 
            legend.stack = "horizontal",
            legend.frame = FALSE, 
            legend.text.size = 1, legend.width = -0.2) +
tm_shape(May05centroid) +
  tm_symbols(size = 1.25, col = "black", shape = 24)  +
  tm_layout(title = "May 5, 2007 \n 90 tornadoes", 
              title.position = c("center", "top"), 
              legend.title.size = 1.4,
              legend.position = c("right", "bottom"), 
              legend.stack = "horizontal",
              legend.frame = FALSE, 
              legend.text.size = 1.2, 
              legend.width = -0.2, 
              title.size = 1.5)
)

May2007
```


```{r}
tmap_arrange(May1996, May2007)
```

Environmental Data: 

*Cluster statistics by time of day. Each cluster is categorized by the closest three-hour time (defined by the NARR data) prior to the first tornado.*
```{r}
BigDays.sfdfT %>%
  group_by(NARRZtime) %>%
  summarize(NumClus = n(),
            NumTorns = sum(nT),
            AvgTornsperClus = NumTorns/NumClus,
            AvgDur = mean(Duration)/3600)

258 + 218 + 34
510/830
```

Compute the yearly averages and yearly anomalies. 
```{r}

timeseries_env <- as.data.frame(BigDays.sfdfT) %>%
  group_by(Year) %>%
  summarize(yravgCAPE = mean(maxCAPE),
            yravgCIN = mean(minCIN),
            yravgDLBS = mean(maxBS_deep),
            yravgSLBS = mean(maxBS_shallow))

anom_CAPE = mean(timeseries_env$yravgCAPE)
anom_CIN = mean(timeseries_env$yravgCIN)
anom_DLBS = mean(timeseries_env$yravgDLBS)
anom_SLBS = mean(timeseries_env$yravgSLBS)

timeseries_env <- timeseries_env %>%
  mutate(anomCAPE = yravgCAPE - anom_CAPE,
         anomCIN = yravgCIN - anom_CIN,
         anomDLBS = yravgDLBS - anom_DLBS,
         anomSLBS = yravgSLBS - anom_SLBS,
         posCAPE = anomCAPE >= 0,
         posCIN = anomCIN >= 0,
         posDLBS = anomDLBS >= 0,
         posSLBS = anomSLBS >= 0)
```

*May 6, 2003 Big Day*
```{r}
May6 <- BigDays.sfdfT %>%
  filter(ID == "200305062624")
May6th <- st_convex_hull(May6)

May6centroid <- groupDayCentroids.sfdfT %>%
  filter(ID == "200305062624")

May6tornadoes <- All_Tornadoes %>% 
  filter(ID == "20030506" & groupNumber == "2624")
```

```{r, eval = FALSE}
tm_shape(stateBorders) + 
  tm_borders(col = "gray70", alpha = 1) +
  tm_scale_bar(width = .3, size = 0.8, lwd = 1.75, color.dark = "gray70") +
  tm_compass(size = 3, fontsize = 1, lwd = 2, color.dark = "gray70") + 
  tm_layout(legend.bg.color = "white", 
            legend.text.size = .75, 
            attr.position = c("right", "top"), 
            inner.margins = c(.15, .15, .1, .2)) +
#tm_shape(counties.sf) +
#  tm_borders(col = "gray40", alpha = .3) +
#  tm_scale_bar(width = 8, size = 8, color.dark = "gray70") +
  #tm_format("World", legend.position = c("right", "top"),
#                   attr.position = c("right", "top"),
#                   legend.frame = FALSE,
                   #title = "May 30th Tornado Group",
                   #title.size = 1.3,
                   #title.position = c("left", "TOP"),
 #                  inner.margins = c(.2, .2, .2, .2)) +
tm_shape(May6, is.master = TRUE, projection = merc) +
  tm_borders(col = "black", lwd = 3) +
tm_shape(May6tornadoes) +
  tm_symbols(size = 2, col = "purple4", alpha = 0.8, border.alpha = 0) +
    tm_layout(legend.title.size = 1.1,
            legend.position = c("right", "bottom"), 
            legend.stack = "horizontal",
            legend.frame = FALSE, 
            legend.text.size = 1, legend.width = -0.2) +
tm_shape(May6centroid) +
  tm_symbols(size = 1.25, col = "black", shape = 24) 
```

*Plot the CAPE, HLCY, and CIN for the May 6, 2003 Big Day. First, read in the raster. *
```{r}
library(raster)
 rb <- brick(paste0("/Users/zoeschroder/Desktop/Projects/Dissertation_OutbreakClimatology/merged_AWIP32.20030506/merged_AWIP32.2003050612")) #<-- this is for varying NARR times
  CAPE <- raster(rb, layer = 375)
  HLCY <- raster(rb, layer = 323)
  CIN <- raster(rb, layer = 376)
  UGRD500 <- raster(rb, layer = 117) 
  VGRD500 <- raster(rb, layer = 118) 
  UGRDsfc <- raster(rb, layer = 293) 
  VGRDsfc <- raster(rb, layer = 294)     
  BS <- sqrt(((UGRD500 - UGRDsfc)**2) + ((VGRD500 - VGRDsfc)**2))
```

**Convective Available Potential energy **
```{r}
CAPE_May6 <- crop(CAPE, extent(May6))
CAPE_extent<- mask(CAPE_May6, May6)
plot(CAPE_extent)

maxCAPE <- which.max(CAPE_extent) #Returns a pixel number

#Test that this max value equals the one in BigDays.sfdfT
test <- getValues(CAPE_extent) 
test<-as.matrix(test, ncol=1)
```

```{r}
CAPEmaxpos <- xyFromCell(CAPE_extent, maxCAPE)

xy <- data.frame(CAPEmaxpos)
CAPE_latlon <- data.frame(lon=xy$x, lat=xy$y)
print(CAPE_latlon)

CAPE_latlon <- SpatialPoints(CAPE_latlon)
proj4string(CAPE_latlon) = CRS("+proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107 +x_0=0 +y_0=0 +a=6371200 +b=6371200 +units=m +no_defs")
```

```{r}
counties <- us_counties()
states <- us_states()
```

```{r, eval = FALSE}
p1 <- tm_shape(CAPE_extent) +
  tm_raster(title = "",  n = 6, palette = "BuPu") +
  tm_format(title = expression(paste("CAPE [J ", kg^-1, "]")), "World", legend.position = c("right", "bottom"),
                   attr.position = c("right", "bottom"),
                   legend.frame = FALSE,
                   inner.margins = c(.15, 0, .15, .18), #bottom, left, top
                    legend.text.size = 1, legend.width = -0.28, legend.title.size=1, legend.bg.color = "white", title.size = 1.4) +
#tm_shape(counties) +
  #tm_borders(col = "grey") +
  tm_scale_bar(width = 0.3, size = 0.8, position = c("right", "top"), color.dark = "gray70") +
tm_shape(states) +
  tm_borders() +
tm_shape(May6, is.master = TRUE, projection = merc) +
  tm_borders(col = "black", lwd = 3)  +
#tm_shape(May6centroid) +
#  tm_symbols(size = 1.25, col = "black", shape = 24) +
tm_shape(CAPE_latlon) + 
  tm_symbols(size = 1.4, col = "black", shape = 22)
p1
```

**Helicity**
```{r}
HLCY_May6 <- crop(HLCY, extent(May6))
HLCY_extent<- mask(HLCY_May6, May6)
plot(HLCY_extent)

maxHLCY <- which.max(HLCY_extent)
```

```{r}
HLCYmaxpos <- xyFromCell(HLCY_extent, maxHLCY)

xy <- data.frame(HLCYmaxpos)
HLCY_latlon <- data.frame(lon=xy$x, lat=xy$y)
print(HLCY_latlon)

HLCY_latlon <- SpatialPoints(HLCY_latlon)
proj4string(HLCY_latlon) = CRS("+proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107 +x_0=0 +y_0=0 +a=6371200 +b=6371200 +units=m +no_defs")
```

```{r, eval = FALSE}
p2 <- tm_shape(HLCY_extent) +
  tm_raster(title = "", n = 5, palette = "BuPu") + #"YlGnBu") +
  tm_format(title = expression(paste("Helicity [",m^2, s^-2, "]")), "World", legend.position = c("right", "bottom"),
                   attr.position = c("right", "bottom"),
                   legend.frame = FALSE,
                   inner.margins = c(.15, 0, .15, .15), #bottom, left, top
                    legend.text.size = 1, legend.width = -0.25, legend.title.size=1, legend.bg.color = "white", title.size = 1.4) +
#tm_shape(counties) +
#  tm_borders(col = "grey") +
  tm_scale_bar(width = 0.3, size = 0.8, position = c("right", "top"), color.dark = "gray70") +
tm_shape(states) +
  tm_borders() +
tm_shape(May6, is.master = TRUE, projection = merc) +
  tm_borders(col = "black", lwd = 3)  +
#tm_shape(May6centroid) +
#  tm_symbols(size = 1.25, col = "black", shape = 24) +
tm_shape(HLCY_latlon) + 
  tm_symbols(size = 1.4, col = "black", shape = 22)
p2
```

**Convective Inhibition **
```{r}
CIN_May6 <- crop(CIN, extent(May6))
CIN_extent<- mask(CIN_May6, May6)

minCIN <- which.min(CIN_extent)
```

```{r}
CINminpos <- xyFromCell(CIN_extent, minCIN)

xy <- data.frame(CINminpos)
CIN_latlon <- data.frame(lon=xy$x, lat=xy$y)
print(CIN_latlon)

CIN_latlon <- SpatialPoints(CIN_latlon)
proj4string(CIN_latlon) = CRS("+proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107 +x_0=0 +y_0=0 +a=6371200 +b=6371200 +units=m +no_defs")
```

```{r, eval = FALSE}
p3 <- tm_shape(CIN_extent) +
  tm_raster(title = "", n =5, palette = "BuPu") + #"YlOrBr") +
  tm_format(title = expression(paste("CIN [J ", kg^-1, "]")), "World", legend.position = c("right", "bottom"),
                   attr.position = c("right", "bottom"),
                   legend.frame = FALSE,
                   inner.margins = c(.15, 0, .15, .15), #bottom, left, top
                    legend.text.size = 1., legend.width = -0.3, legend.title.size=1, legend.bg.color = "white", title.size = 1.4) +
#tm_shape(counties) +
#  tm_borders(col = "grey") +
  tm_scale_bar(width = 0.3, size = 0.8, position = c("right", "top"), color.dark = "gray70") +
tm_shape(states) +
  tm_borders() +
tm_shape(May6, is.master = TRUE, projection = merc) +
  tm_borders(col = "black", lwd = 3)  +
#tm_shape(May6centroid) +
#  tm_symbols(size = 1.25, col = "black", shape = 24) +
tm_shape(CIN_latlon) + 
  tm_symbols(size = 1.4, col = "black", shape = 22)
p3
```

**Bulk Shear**
```{r}
BS_May6 <- crop(BS, extent(May6))
BS_extent<- mask(BS_May6, May6)
plot(BS_extent)

maxBS <- which.max(BS_extent)
```

```{r}
BSmaxpos <- xyFromCell(BS_extent, maxBS)

xy <- data.frame(BSmaxpos)
BS_latlon <- data.frame(lon=xy$x, lat=xy$y)
print(BS_latlon)

BS_latlon <- SpatialPoints(BS_latlon)
proj4string(BS_latlon) = CRS("+proj=lcc +lat_1=50 +lat_2=50 +lat_0=50 +lon_0=-107 +x_0=0 +y_0=0 +a=6371200 +b=6371200 +units=m +no_defs")
```

```{r, eval = FALSE}
p4 <- tm_shape(BS_extent) +
  tm_raster(title = "", n = 5, palette = "BuPu") +
  tm_format(title = expression(paste("Bulk Shear [m ", s^-1, "]")), "World", legend.position = c("right", "bottom"),
                   attr.position = c("right", "bottom"),
                   legend.frame = FALSE,
                   inner.margins = c(.15, 0, .15, .15), #bottom, left, top
                    legend.text.size = 1, legend.width = -0.2, legend.title.size=1, legend.bg.color = "white", title.size = 1.4) +
#tm_shape(counties) +
#  tm_borders(col = "grey") +
  tm_scale_bar(width = 0.3, size = 0.8, position = c("right", "top"), color.dark = "gray70") +
tm_shape(states) +
  tm_borders() +
tm_shape(May6, is.master = TRUE, projection = merc) +
  tm_borders(col = "black", lwd = 3)  +
#tm_shape(May6centroid) +
#  tm_symbols(size = 1.25, col = "black", shape = 24) +
tm_shape(BS_latlon) + 
  tm_symbols(size = 1.4, col = "black", shape = 22)
p4
```

**Combine into one figure: **
```{r}
tmap_arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)
```
`Figure 4: Environmental conditions at 12 UTC on May 6, 2003. The black line is the spatial extent of the tornado genesis locations and the black triangle is the centroid of the locations. The first tornado in the cluster started at 14:20 UTC. The black square indicates the locations of the highest value of CAPE (3660~J~kg$^{-1}$), the lowest value of CIN ($-$149~J~kg$^{-1}$), the highest value of helicity (308~m$^2$~s$^{-2}$) and the highest value of bulk shear (33~m~s$^{-1}$).`

*Create a correlation matrix of the environmental variables*
```{r}
Env_dat <- data.frame(CAPE = BigDays.sfdfT$maxCAPE, CIN = BigDays.sfdfT$minCIN, HLCY = BigDays.sfdfT$maxHLCY, DEW = BigDays.sfdfT$maxDEW, DeepBS = BigDays.sfdfT$maxBS_deep, ShallowBS = BigDays.sfdfT$maxBS_shallow)
ggpairs(Env_dat)
cor(Env_dat)
```

## Preliminary figures of the Environmental Data ##

Plot the figures for the yearly average extreme value for CAPE, CIN, DLBS, and SLBS. 

**Average Extremes of the Environmental Factors**
Graph of yearly average maximum CAPE.
```{r, eval = FALSE}
yearCAPEgraph <- ggplot(timeseries_env, (aes(x = Year, y = yravgCAPE))) +
 geom_smooth(method = lm, span = .5, se = FALSE, color = "gray70", size = 1) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2018,1))) +
  scale_y_continuous(limits = c(1500, 3000), breaks = c(seq(1500,3000,250))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Monthly Average of Extreme CAPE (in Clusters)")

yearCAPEgraph <- yearCAPEgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))

yearCAPEgraph
```

Graph of yearly average minimum CIN.
```{r, eval = FALSE}
yearCINgraph <- ggplot(timeseries_env, (aes(x = Year, y = yravgCIN))) +
 geom_smooth(method = lm, span = .5, se = FALSE, color = "gray70", size = 1) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2018,1))) +
  scale_y_continuous(limits = c(-175, -50), breaks = c(seq(-175,-50,25))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Monthly Average of Extreme CIN (in Clusters)")

yearCINgraph <- yearCINgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))

yearCINgraph
```

Graph of yearly average maximum DLBS.
```{r, eval = FALSE}
yearDLBSgraph <- ggplot(timeseries_env, (aes(x = Year, y = yravgDLBS))) +
 geom_smooth(method = lm, span = .5, se = FALSE, color = "gray70", size = 1) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2018,1))) +
  scale_y_continuous(limits = c(22, 34), breaks = c(seq(22,34,2))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Monthly Average of Extreme DLBS (in Clusters)")

yearDLBSgraph <- yearDLBSgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))

yearDLBSgraph
```

Graph of yearly average maximum SLBS.
```{r, eval = FALSE}
yearSLBSgraph <- ggplot(timeseries_env, (aes(x = Year, y = yravgSLBS))) +
 geom_smooth(method = lm, span = .5, se = FALSE, color = "gray70", size = 1) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2018,1))) +
  scale_y_continuous(limits = c(10, 20), breaks = c(seq(10,20,2))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Monthly Average of Extreme SLBS (in Clusters)")

yearSLBSgraph <- yearSLBSgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))

yearSLBSgraph
```

```{r}
#library(ggpubr)
ggarrange(yearCAPEgraph, yearCINgraph, yearDLBSgraph, yearSLBSgraph)
```

**The Anomalies**

Graph of yearly anomaly of maximum CAPE.
```{r}
yearCAPEgraph <- ggplot(timeseries_env, aes(x = Year, y = anomCAPE)) +
  geom_bar(stat = "identity", aes(fill = posCAPE)) +
  scale_fill_manual(values = c("red2", "blue2"), guide = FALSE) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2020,1))) +
  geom_label(label = paste("Average:", round(anom_CAPE, digits = 2), paste0('J/kg')), x = 1998, y = -600) +
  theme_bw() +
  xlab("Year") +
  ylab("Anomalies of Extreme CAPE (in Clusters)")

yearCAPEgraph <- yearCAPEgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))
```

Graph of yearly anomaly of minimum CIN.
```{r}
yearCINgraph <- ggplot(timeseries_env, aes(x = Year, y = anomCIN)) +
  geom_bar(stat = "identity", aes(fill = posCIN)) +
  scale_fill_manual(values = c("red2", "blue2"), guide = FALSE) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2020,1))) +
    geom_label(label = paste("Average:", round(anom_CIN, digits = 2), paste0('J/kg')), x = 1998, y = -50) +
  theme_bw() +
  xlab("Year") +
  ylab("Anomalies of Extreme CIN (in Clusters)")

yearCINgraph <- yearCINgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))
```

Graph of yearly anomaly of maximum DLBS.
```{r}

yearDLBSgraph <- ggplot(timeseries_env, aes(x = Year, y = anomDLBS)) +
  geom_bar(stat = "identity", aes(fill = posDLBS)) +
  scale_fill_manual(values = c("red2", "blue2"), guide = FALSE) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2020,1))) +
  geom_label(label = paste("Average:", round(anom_DLBS, digits = 2), paste0('m/s')), x = 1998, y = 3) +
  theme_bw() +
  xlab("Year") +
  ylab("Anomalies of Extreme DLBS (in Clusters)")

yearDLBSgraph <- yearDLBSgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))
```

Graph of yearly anomaly of maximum SLBS.
```{r}
yearSLBSgraph <- ggplot(timeseries_env, aes(x = Year, y = anomSLBS)) +
  geom_bar(stat = "identity", aes(fill = posSLBS)) +
  scale_fill_manual(values = c("red2", "blue2"), guide = FALSE) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2020,1))) +
  geom_label(label = paste("Average:", round(anom_SLBS, digits = 2), paste0('m/s')), x = 1998, y = 3.15) +
  theme_bw() +
  xlab("Year") +
  ylab("Anomalies of Extreme SLBS (in Clusters)")

yearSLBSgraph <- yearSLBSgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))
```

```{r}
#library(ggpubr)
ggarrange(yearCAPEgraph, yearCINgraph, yearDLBSgraph, yearSLBSgraph)
```

## Preliminary figures of the climate data

```{r}
ClimatebyMonth <- BigDays.sfdfT %>%
  group_by(Mo) %>%
  summarize(maxtempanom = max(max_airtemp),
            SST_max = max(Atlantic_SST),
            ElNino_max  = max(ElNino34),
            SIE_max = max(SIE))

ClimatebyYear <- BigDays.sfdfT %>%
  group_by(Mo, Year) %>%
  summarize(maxtempanom = max(max_airtemp),
            SST_max = max(Atlantic_SST),
            ElNino_max  = max(ElNino34),
            SIE_max = max(SIE))
```


```{r}
 slopevals = numeric()
slopeargs = numeric()
for (i in 1994:2020) {
      dat <- ClimatebyYear %>% filter(Year == i)
      model = lm(maxtempanom ~ Mo, data = dat)
      slope = model$coefficients[2]
      slopearg = ifelse(model$coefficients[2] >= 0,  "POS", "NEG")
      slopeargs = append(slopeargs, slopearg)
      slopevals = append(slopevals, slope)
}

slope_group = character()
slope_vals = numeric()

for (i in 1:dim(ClimatebyYear)[1]) {
  yr = ClimatebyYear$Year[i]
  yearfordat = (yr - 1994)
  slope_group = append(slope_group, as.data.frame(slopeargs)[1 + yearfordat,])
  slope_vals = append(slope_vals, as.data.frame(slopevals)[1 + yearfordat,])
}

ClimatebyYear$group_Temp <- slope_group
ClimatebyYear$slope_Temp <- slope_vals
```

```{r}
month <- month.abb

yearClimatetempgraph <- ggplot(ClimatebyYear, (aes(x = Mo, y = maxtempanom))) +
 geom_smooth(aes(color=group_Temp), method = lm, span = .5, se = FALSE, size = 1) +
  scale_colour_manual(labels = c("Negative Trend", "Positive Trend"), values = c('red', 'blue')) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1,12,1)), labels = month) +
 # scale_y_continuous(limits = c(1500, 3000), breaks = c(seq(1500,3000,250))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Surface Temperature Anomalies in the U.S.") +
  facet_wrap(~ Year, ncol = 3)

yearClimatetempgraph <- yearClimatetempgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 60, hjust = 1), axis.text = element_text(size = 10), axis.title=element_text(size=14), legend.title = element_blank(), legend.position = "bottom", legend.key.size = unit(1, "cm"),legend.text=element_text(size=12), panel.spacing = unit(1, "lines"))

yearClimatetempgraph
```


```{r}
 slopevals = numeric()
slopeargs = numeric()
for (i in 1994:2020) {
      dat <- ClimatebyYear %>% filter(Year == i)
      model = lm(SST_max ~ Mo, data = dat)
      slope = model$coefficients[2]
      slopearg = ifelse(model$coefficients[2] >= 0,  "POS", "NEG")
      slopeargs = append(slopeargs, slopearg)
      slopevals = append(slopevals, slope)
}

slope_group = character()
slope_vals = numeric()

for (i in 1:dim(ClimatebyYear)[1]) {
  yr = ClimatebyYear$Year[i]
  yearfordat = (yr - 1994)
  slope_group = append(slope_group, as.data.frame(slopeargs)[1 + yearfordat,])
  slope_vals = append(slope_vals, as.data.frame(slopevals)[1 + yearfordat,])
}

ClimatebyYear$group_SST <- slope_group
ClimatebyYear$slope_SST <- slope_vals
```

```{r}
month <- month.abb

yearSSTgraph <- ggplot(ClimatebyYear, (aes(x = Mo, y = SST_max))) +
 geom_smooth(aes(color=group_SST), method = lm, span = .5, se = FALSE, size = 1) +
  scale_colour_manual(labels = c("Positive Trend", "Negative Trend"), values = c('blue', 'red')) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1,12,1)), labels = month) +
 # scale_y_continuous(limits = c(1500, 3000), breaks = c(seq(1500,3000,250))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Maximum Sea Surface Temperatures in Caribbean [degrees C]") +
  facet_wrap(~ Year, ncol = 3)

yearSSTgraph <- yearSSTgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 60, hjust = 1), axis.text = element_text(size = 10), axis.title=element_text(size=14), legend.title = element_blank(), legend.position = "bottom", legend.key.size = unit(1, "cm"),legend.text=element_text(size=12), panel.spacing = unit(1, "lines"))

yearSSTgraph
```

```{r}
 slopevals = numeric()
slopeargs = numeric()
for (i in 1994:2020) {
      dat <- ClimatebyYear %>% filter(Year == i)
      model = lm(ElNino_max ~ Mo, data = dat)
      slope = model$coefficients[2]
      slopearg = ifelse(model$coefficients[2] >= 0,  "POS", "NEG")
      slopeargs = append(slopeargs, slopearg)
      slopevals = append(slopevals, slope)
}

slope_group = character()
slope_vals = numeric()

for (i in 1:dim(ClimatebyYear)[1]) {
  yr = ClimatebyYear$Year[i]
  yearfordat = (yr - 1994)
  slope_group = append(slope_group, as.data.frame(slopeargs)[1 + yearfordat,])
  slope_vals = append(slope_vals, as.data.frame(slopevals)[1 + yearfordat,])
}

ClimatebyYear$group_ElNino <- slope_group
ClimatebyYear$slope_ElNino <- slope_vals
```

```{r}
month <- month.abb

yearElNinograph <- ggplot(ClimatebyYear, (aes(x = Mo, y = ElNino_max))) +
 geom_smooth(aes(color=group_ElNino), method = lm, span = .5, se = FALSE, size = 1) +
  scale_colour_manual(labels = c("Negative Trend", "Positive Trend"), values = c('red', 'blue')) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1,12,1)), labels = month) +
 # scale_y_continuous(limits = c(1500, 3000), breaks = c(seq(1500,3000,250))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Maximum El Nino Temperatures [degrees C]") +
  facet_wrap(~ Year, ncol = 3)

yearElNinograph <- yearElNinograph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 60, hjust = 1), axis.text = element_text(size = 10), axis.title=element_text(size=14), legend.title = element_blank(), legend.position = "bottom", legend.key.size = unit(1, "cm"),legend.text=element_text(size=12), panel.spacing = unit(1, "lines"))

yearElNinograph
```

```{r}
 slopevals = numeric()
slopeargs = numeric()
for (i in 1994:2020) {
      dat <- ClimatebyYear %>% filter(Year == i)
      model = lm(SIE_max ~ Mo, data = dat)
      slope = model$coefficients[2]
      slopearg = ifelse(model$coefficients[2] >= 0, "POS", "NEG")
      slopeargs = append(slopeargs, slopearg)
      slopevals = append(slopevals, slope)
}

slope_group = character()
slope_vals = numeric()

for (i in 1:dim(ClimatebyYear)[1]) {
  yr = ClimatebyYear$Year[i]
  yearfordat = (yr - 1994)
  slope_group = append(slope_group, as.data.frame(slopeargs)[1 + yearfordat,])
  slope_vals = append(slope_vals, as.data.frame(slopevals)[1 + yearfordat,])
}

ClimatebyYear$group_SIE <- slope_group
ClimatebyYear$slope_SIE <- slope_vals
```

```{r}
month <- month.abb

yearSIEgraph <- ggplot(ClimatebyYear, (aes(x = Mo, y = SIE_max))) +
 geom_smooth(aes(color=group_SIE), method = lm, span = .5, se = FALSE, size = 1) +
  scale_colour_manual(labels = c("Negative Trend", "Positive Trend"), values = c('red', 'blue')) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1,12,1)), labels = month) +
 # scale_y_continuous(limits = c(1500, 3000), breaks = c(seq(1500,3000,250))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Maximum Arctic Sea Ice Extent [millions of square kilometers]") +
  facet_wrap(~ Year, ncol = 3)

yearSIEgraph <- yearSIEgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 60, hjust = 1), axis.text = element_text(size = 10), axis.title=element_text(size=14), legend.title = element_blank(), legend.position = "bottom", legend.key.size = unit(1, "cm"),legend.text=element_text(size=12), panel.spacing = unit(1, "lines"))

yearSIEgraph
```

## Descriptive Statistics

```{r}
Climate_dat <- data.frame(AirTemperature = BigDays.sfdfT$avg_airtemp, SST = BigDays.sfdfT$Atlantic_SST, ArcticSIE = BigDays.sfdfT$SIE, ElNino = BigDays.sfdfT$ElNino34)
ggpairs(Climate_dat)
cor(Climate_dat)
```

What is the correlation between the variables? 
```{r}
Model_dat <- data.frame(AirTemperature = BigDays.sfdfT$avg_airtemp, ATL_SST = BigDays.sfdfT$Atlantic_SST, GAK_SST = BigDays.sfdfT$GAK_SST, ArcticSIE = BigDays.sfdfT$SIE, ElNino = BigDays.sfdfT$ElNino34, CAPE = BigDays.sfdfT$maxCAPE, CIN = BigDays.sfdfT$minCIN, HLCY = BigDays.sfdfT$maxHLCY, DEW = BigDays.sfdfT$maxDEW, DeepBS = BigDays.sfdfT$maxBS_deep, ShallowBS = BigDays.sfdfT$maxBS_shallow)

xtable(cor(Model_dat))
```

Create a figure of the correlation matrix. 
```{r}
#install.packages("corrr")
library(corrr)

as.data.frame(Model_dat) %>% correlate() %>% network_plot(min_cor=0.5)
```

Try an alternative visualization: 
```{r}
library(corrplot)
names(Model_dat)[names(Model_dat) == 'AirTemperature'] <- 'AirTemp'

corrplot.mixed(cor(Model_dat), tl.col="black", lower.col="black", number.cex = 1, tl.cex = 1)

```

```{r}
ggcorr(Model_dat, nbreaks=8, palette='RdGy', label=TRUE, label_size=5, label_color='white')
```

```{r}
install.packages("ggcorrplot")
library(ggcorrplot)
ggcorrplot(cor(Model_dat), p.mat = cor_pmat(Model_dat), hc.order=TRUE, type='lower')
```


```{r}
x <- BigDays.sfdfT %>%
  filter(nT==10)
dim(x)[1]
#88
x <- BigDays.sfdfT %>%
  filter(nT>=30)
dim(x)[1]
#166
x <- BigDays.sfdfT %>%
  filter(nT>=50)
dim(x)[1]
#52
```

```{r}
x <- BigDays.sfdfT %>%
  filter(GroupDayCas==0)
dim(x)[1]
#293
x <- BigDays.sfdfT %>%
  filter(GroupDayCas>=30)
dim(x)[1]
#132
x <- BigDays.sfdfT %>%
  filter(GroupDayCas>=50)
dim(x)[1]
#90
```

```{r}
(plot_CAPE <- ggplot(BigDays.sfdfT, aes(maxCAPE)) + 
  geom_histogram(boundary = 50, 
                 bins = 43, 
                 alpha = 0.9, 
                 color = "white", 
                 fill = "Grey40",
                 size = 0.1) +
  scale_x_continuous(expand = c(0,0), limits = c(0,7000)) +
  #scale_x_log10() + 
  xlab("Maximum CAPE [J/kg]") +
  scale_y_continuous(expand = c(0,0), breaks = c(0, 10,20,30,40,50), labels = c("0", "10", "20", "30", "40", "50"), limits = c(0, 50)) +
  ylab("Number of Clusters") + 
  ggtitle("A") +
  theme_bw() +
  theme(text = element_text(size=12), plot.background = element_rect(color = "grey40"), panel.border = element_rect(color = "white"), plot.margin=unit(c(0.5, 0.5, 0.5, 0.5),"cm")))

(plot_DLBS <- ggplot(BigDays.sfdfT, aes(maxBS_deep)) + 
  geom_histogram(boundary = 50, 
                 bins = 43, 
                 alpha = 0.9, 
                 color = "white", 
                 fill = "Grey40",
                 size = 0.1) +
  scale_x_continuous(expand = c(0,0), limits = c(0,50)) +
  #scale_x_log10() + 
  xlab("Maximum Deep Layer Bulk Shear [m/s]") +
  scale_y_continuous(expand = c(0,0), breaks = c(0, 10,20,30,40,50, 60), labels = c("0", "10", "20", "30", "40", "50", "60"), limits = c(0, 60)) +
  ylab("Number of Clusters") + 
  ggtitle("B") +
  theme_bw() +
  theme(text = element_text(size=12), plot.background = element_rect(color = "grey40"), panel.border = element_rect(color = "white"), plot.margin=unit(c(0.5, 0.5, 0.5, 0.5),"cm")))


(plot_SLBS <- ggplot(BigDays.sfdfT, aes(maxBS_shallow)) + 
  geom_histogram(boundary = 50, 
                 bins = 43, 
                 alpha = 0.9, 
                 color = "white", 
                 fill = "Grey40",
                 size = 0.1) +
  scale_x_continuous(expand = c(0,0), limits = c(0,40)) +
  #scale_x_log10() + 
  xlab("Maximum Shallow Layer Bulk Shear [m/s]") +
  scale_y_continuous(expand = c(0,0), breaks = c(0, 10,20,30,40,50), labels = c("0", "10", "20", "30", "40", "50"), limits = c(0, 50)) +
  ylab("Number of Clusters") + 
  ggtitle("C") +
  theme_bw() +
  theme(text = element_text(size=12), plot.background = element_rect(color = "grey40"), panel.border = element_rect(color = "white"), plot.margin=unit(c(0.5, 0.5, 0.5, 0.5),"cm")))

ggarrange(plot_CAPE, plot_DLBS, plot_SLBS, ncol = 1)
```


```{r}
(plot_nT <- ggplot(BigDays.sfdfT, aes(nT)) + 
  geom_histogram(boundary = 50, 
                 bins = 43, 
                 alpha = 0.9, 
                 color = "white", 
                 fill = "Grey40",
                 size = 0.1) +
  scale_x_continuous(expand = c(0,0), limits = c(9,50)) +
  #scale_x_log10() + 
  xlab("Number of Tornadoes") +
  scale_y_continuous(expand = c(0,0), breaks = c(0, 25, 50, 75, 100), labels = c("0", "25", "50", "75", "100"), limits = c(0, 100)) +
  ylab("Number of Clusters") + 
  ggtitle("A") +
  theme_bw() +
  theme(text = element_text(size=12), plot.background = element_rect(color = "grey40"), panel.border = element_rect(color = "white"), plot.margin=unit(c(0.5, 0.5, 0.5, 0.5),"cm")))

(plot_cas <- ggplot(BigDays.sfdfT, aes(GroupDayCas)) + 
  geom_histogram(boundary = 50, 
                 bins = 43, 
                 alpha = 0.9, 
                 color = "white", 
                 fill = "Grey40",
                 size = 0.1) +
  scale_x_continuous(expand = c(0,0),limits = c(0,50)) +
  #scale_x_log10() + 
  xlab("Number of Casualties") +
  scale_y_continuous(expand = c(0,0), breaks = c(0, 100, 200, 300, 400), labels = c("0", "100", "200", "300", "400"), limits = c(0, 400)) +
  ylab("Number of Clusters") + 
  ggtitle("B") +
  theme_bw() +
  theme(text = element_text(size=12), plot.background = element_rect(color = "grey40"), panel.border = element_rect(color = "white"), plot.margin=unit(c(0.5, 0.5, 0.5, 0.5),"cm")))
```

```{r}
ggarrange(plot_nT, plot_cas, ncol = 2)
```

```{r}
library(dplyr)
x <-  BigDays.sfdfT %>%
  group_by(Year) %>%
  summarize(maxSIE = max(SIE))

SIEgraph <- ggplot(x, (aes(x = Year, y = maxSIE))) +
 geom_smooth(method = lm, span = .5, se = FALSE, color = "red", size = 1) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2020,1))) +
  scale_y_continuous(limits = c(14, 16), breaks = c(seq(14,16,0.25))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Maximum Sea Ice Extent [millions of square km]")

SIEgraph <- SIEgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))
SIEgraph
```

```{r}
x <-  BigDays.sfdfT %>%
  group_by(Year) %>%
  summarize(maxNino = max(ElNino34))

Ninograph <- ggplot(x, (aes(x = Year, y = maxNino))) +
 geom_smooth(method = lm, span = .5, se = FALSE, color = "blue", size = 1) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2020,1))) +
  scale_y_continuous(limits = c(26.5, 30), breaks = c(seq(26.5,30,0.5))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab(" Maximum El Nino 3.4 Index")

Ninograph <- Ninograph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))
Ninograph
```

```{r}
x <-  BigDays.sfdfT %>%
  group_by(Year) %>%
  summarize(maxairtemp = max(avg_airtemp))

airtempgraph <- ggplot(x, (aes(x = Year, y = maxairtemp))) +
 geom_smooth(method = lm, span = .5, se = FALSE, color = "blue", size = 1) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2020,1))) +
  scale_y_continuous(limits = c(0,3), breaks = c(seq(0,3,0.25))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Maximum Air Temperature Anomalies")

airtempgraph <- airtempgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))
airtempgraph
```

```{r}
x <-  BigDays.sfdfT %>%
  group_by(Year) %>%
  summarize(maxSST = max(Atlantic_SST))

SSTgraph <- ggplot(x, (aes(x = Year, y = maxSST))) +
 geom_smooth(method = lm, span = .5, se = FALSE, color = "blue", size = 1) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2020,1))) +
  scale_y_continuous(limits = c(28,29.25), breaks = c(seq(28,29.25,0.25))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Maximum Atlantic SST [degrees C]")

SSTgraph <- SSTgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))
SSTgraph
```

```{r}
x <-  BigDays.sfdfT %>%
  group_by(Year) %>%
  summarize(maxSST = max(GAK_SST))

GAKSSTgraph <- ggplot(x, (aes(x = Year, y = maxSST))) +
 geom_smooth(method = lm, span = .5, se = FALSE, color = "red", size = 1) +
  geom_line(color = "black", lwd = 1) +
  scale_x_continuous(expand = c(0, 0), breaks = c(seq(1994,2020,1))) +
  scale_y_continuous(limits = c(6,15), breaks = c(seq(6,15,1))) + 
#  geom_smooth(aes(x = week, y = probs/100), span = .5, se = FALSE, color = "gray70", size = 1) +
  theme_bw() +
  xlab("Year") +
  ylab("Maximum Gulf of Alaska SST [degrees C]")

GAKSSTgraph <- GAKSSTgraph + theme(axis.title.y = element_text(colour = "black"), axis.text.y = element_text(color = "black"),  axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 12), axis.title=element_text(size=14))
GAKSSTgraph
```


```{r}
ggarrange(SIEgraph, Ninograph, airtempgraph, SSTgraph, GAKSSTgraph)
```

